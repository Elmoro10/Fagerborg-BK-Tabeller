<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tabeller ‚Äì Fagerborg BK</title>

  <style>
    :root{
      --bg:#f3f5f7;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#6b7280;
      --line:#e5e7eb;
      --head:#ffffff;

      --win:#22c55e;
      --draw:#cbd5e1;
      --loss:#ef4444;

      --stripe:#2563eb;     /* PL-ish bl√• */
      --stripeB:#b91c1c;    /* B-lag stripe */
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: var(--bg);
      color: var(--text);
    }

    .wrap{max-width:1200px;margin:0 auto;padding:26px 16px 40px}

    header{
      display:flex;justify-content:space-between;align-items:flex-end;
      gap:12px;flex-wrap:wrap;margin-bottom:18px;
    }

    h1{margin:0;font-size:42px;letter-spacing:-.02em}
    .sub{margin-top:4px;color:var(--muted);font-size:15px}

    .btn{
      background:#fff;border:1px solid var(--line);
      padding:10px 16px;border-radius:999px;
      font-weight:800;cursor:pointer;
    }

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media(max-width:920px){.grid{grid-template-columns:1fr}}

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      overflow:hidden;
      box-shadow:0 12px 40px rgba(0,0,0,.06);
    }

    .card-head{
      padding:14px 16px;
      display:flex;align-items:center;justify-content:space-between;
      border-bottom:1px solid var(--line);
      background:#f8fafc;
    }

    .title{font-size:22px;font-weight:950;letter-spacing:-.01em}
    .badge{
      font-size:13px;font-weight:800;color:#334155;
      border:1px solid var(--line);
      background:#fff;
      padding:6px 12px;border-radius:999px;
    }

    .content{padding:0}

    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      font-size:14px;
    }

    thead th{
      background:var(--head);
      color:#94a3b8;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.08em;
      padding:14px 14px 10px;
      border-bottom:1px solid var(--line);
      text-align:left;
      white-space:nowrap;
    }

    tbody tr{
      background:#fff;
      position:relative;
    }

    tbody tr::before{
      content:"";
      position:absolute;
      left:0;top:0;bottom:0;
      width:4px;background:transparent;
    }
    tbody tr.a::before{ background: var(--stripe); }
    tbody tr.b::before{ background: var(--stripeB); }

    tbody td{
      padding:16px 14px;
      border-bottom:1px solid var(--line);
      vertical-align:middle;
    }

    tbody tr:hover{background:#fafafa}

    .pos{width:52px;font-weight:900}
    .team{font-weight:950}
    .num,.goals,.diff,.pts{font-variant-numeric:tabular-nums;text-align:center}
    .num{width:58px}
    .goals{width:84px}
    .diff{width:64px}
    .pts{width:62px;font-weight:950}

    .form{width:160px;text-align:right}
    .dots{display:inline-flex;gap:8px;justify-content:flex-end;align-items:center}
    .dot{width:10px;height:10px;border-radius:999px;background:var(--draw);box-shadow:inset 0 0 0 1px rgba(0,0,0,.08)}
    .dot.w{background:var(--win)}
    .dot.d{background:var(--draw)}
    .dot.l{background:var(--loss)}

    .pill{
      margin:12px 14px 14px;
      display:inline-block;
      font-size:12px;
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px 10px;
      color:#475569;
      background:#fff;
    }

    .loading{padding:18px 14px;color:#64748b}
    .error{padding:18px 14px;color:#991b1b;background:#fee2e2;border-top:1px solid #fecaca}

    .note{
      margin-top:14px;
      background:#fff;
      border:1px solid var(--line);
      padding:10px 12px;
      border-radius:12px;
      color:#334155;
      font-size:13px;
      box-shadow:0 10px 30px rgba(0,0,0,.04);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Tabeller</h1>
        <div class="sub">Seriestilling for Fagerborgs lag (2026)</div>
      </div>
      <button class="btn" onclick="location.reload()">‚ü≥ Oppdater</button>
    </header>

    <section class="grid">
      <div class="card">
        <div class="card-head">
          <div class="title">A-Lag</div>
          <div class="badge">5. divisjon (2026)</div>
        </div>
        <div class="content">
          <div id="a" class="loading">Laster‚Ä¶</div>
        </div>
      </div>

      <div class="card">
        <div class="card-head">
          <div class="title">B-Lag</div>
          <div class="badge">7. divisjon (2026)</div>
        </div>
        <div class="content">
          <div id="b" class="loading">Laster‚Ä¶</div>
        </div>
      </div>
    </section>

    <div class="note" id="meta">‚Äî</div>
  </div>

  <script>
    const esc = s => String(s ?? "").replace(/[&<>"']/g, m => (
      ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])
    ));

    function parseUpdatedAt(updatedAt){
      const s = String(updatedAt || "").trim();
      const m = s.match(/^(\d{4})-(\d{2})-(\d{2})\s+(\d{2}):(\d{2})\s*UTC$/i);
      if(!m) return null;
      const y=+m[1], mo=+m[2]-1, d=+m[3], h=+m[4], mi=+m[5];
      return new Date(Date.UTC(y,mo,d,h,mi,0));
    }

    const calcDiff = goals => {
      const m = String(goals || "").match(/(\d+)\s*[-‚Äì]\s*(\d+)/);
      return m ? String((+m[1])-(+m[2])) : "0";
    };

    const dotsHtml = (form) => {
      // hvis form mangler, vis 5 ‚Äúdraw/gr√•‚Äù
      const arr = Array.isArray(form) ? form.slice(-5) : [];
      const padded = [...Array(Math.max(0, 5 - arr.length)).fill("D"), ...arr];
      return `<span class="dots">${
        padded.map(x => {
          const c = x === "W" ? "w" : x === "L" ? "l" : "d";
          return `<span class="dot ${c}" title="${x}"></span>`;
        }).join("")
      }</span>`;
    };

    function render(elId, block, rowClass){
      const el = document.getElementById(elId);
      if(!block?.rows?.length){
        el.className = "error";
        el.textContent = "Ingen rader funnet (scraper plukket feil tabell).";
        return;
      }

      el.className = "";
      el.innerHTML = `
        <table>
          <thead>
            <tr>
              <th class="pos">Pos</th>
              <th>Club</th>
              <th class="num">P</th>
              <th class="num">W</th>
              <th class="num">D</th>
              <th class="num">L</th>
              <th class="goals">GF-GA</th>
              <th class="diff">Diff</th>
              <th class="pts">Pts</th>
              <th class="form">Form</th>
            </tr>
          </thead>
          <tbody>
            ${block.rows.map(r => {
              const goals = String(r.goals || "0-0").replace("‚Äì","-");
              const diff  = r.diff ? String(r.diff) : calcDiff(goals);
              return `
                <tr class="${rowClass}">
                  <td class="pos">${esc(r.pos)}</td>
                  <td class="team">${esc(r.team)}</td>
                  <td class="num">${esc(r.played ?? "0")}</td>
                  <td class="num">${esc(r.wins ?? "0")}</td>
                  <td class="num">${esc(r.draws ?? "0")}</td>
                  <td class="num">${esc(r.losses ?? "0")}</td>
                  <td class="goals">${esc(goals)}</td>
                  <td class="diff">${esc(diff)}</td>
                  <td class="pts">${esc(r.points ?? "0")}</td>
                  <td class="form">${dotsHtml(r.form)}</td>
                </tr>
              `;
            }).join("")}
          </tbody>
        </table>
        <div class="pill">Kilde: fotball.no (fiksId=${esc(block.fiksId)})</div>
      `;
    }

    async function load(){
      const base = "https://elmoro10.github.io/Fagerborg-BK-Tabeller";
      const url = base + "/data/tables.json?ts=" + Date.now();

      const res = await fetch(url, { cache: "no-store" });
      if(!res.ok) throw new Error("HTTP " + res.status);
      return await res.json();
    }

    async function boot(){
      try{
        const json = await load();
        render("a", json.a, "a");
        render("b", json.b, "b");

        const d = parseUpdatedAt(json.updatedAt);
        document.getElementById("meta").textContent =
          `üïí Sist oppdatert: ${d ? d.toLocaleString("no-NO",{dateStyle:"medium",timeStyle:"short"}) : (json.updatedAt||"ukjent")} ¬∑ oppdateres hvert 5. minutt`;
      }catch(e){
        document.getElementById("a").className = "error";
        document.getElementById("b").className = "error";
        document.getElementById("a").textContent = "Klarte ikke laste tables.json";
        document.getElementById("b").textContent = "Klarte ikke laste tables.json";
        document.getElementById("meta").textContent = "Feil ved lasting.";
      }
    }

    boot();
    setInterval(boot, 60 * 1000); // viktig for IdrettenOnline caching
  </script>
</body>
</html>
